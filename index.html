<!DOCTYPE html>

<meta charset="UTF-8"> 

<html>

<head>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="">
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
    <div id="mapid" style="width: 600px; height: 600px; position:relative;"></div>


    <script>

	var mymap = L.map('mapid').setView([51.505, -0.09], 13);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiamF3YWRzaGFoaWQiLCJhIjoiY2puZzQ0eno3MDRjbDNrcWlsZjZxNTcxaSJ9.mavbvckNOMnntmxWcKboyQ', {
    maxZoom: 18,
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
        '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
        'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    id: 'mapbox.streets'
    }).addTo(mymap);


    </script>


    <button type="button" onclick="loadXMLDoc()">
        Show
    </button>

    <button type="button" onclick="plotsinglepath()">
        Plot Random
    </button>

    <!--
    <button type="button" onclick="plotpath()">
        Plot
    </button>
    -->

    <div id="testing">

    </div>

    <div id="lists_try">

    </div>

    <div id="plotpoints">

    </div>

    <div>
        <h3>
            Average Heart Rate
        </h3>
        <p id="average-HR">

        </p>
    </div>

    <div>
        <h3>
           Average Cadence
        </h3>
        <p id="average-CAD">
    
        </p>
    </div>

    
    <script>
        
        //var text, parser, xmlDoc, serializer;
        
        function loadXMLDoc() {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                myFunction(this);
            }
            };
            xmlhttp.open("GET", "A.gpx", true);
            xmlhttp.send();
        }

        function myFunction(xml) {
            var xmlDoc, txt, alltrkpts;
            xmlDoc = xml.responseXML;
            txt = xmlDoc.getElementsByTagName("name")[0].childNodes[0].nodeValue;
            //alltrkptslen = xmlDoc.getElementsByTagName("ns3:hr").length;
            //document.getElementById("lists_try").innerHTML = alltrkptslen;
            document.getElementById("testing").innerHTML = txt;
            
            plotcords = [];
            plotpoints = xmlDoc.getElementsByTagName("trkpt");
            for (i = 0; i < plotpoints.length; i++) {
                plotcords.push([plotpoints[i].getAttribute('lat'), plotpoints[i].getAttribute('lon')])
            }
            //document.getElementById("plotpoints").innerHTML = plotcords

            var polyline = L.polyline(plotcords, {color: 'red'}).addTo(mymap);
            // zoom the map to the polyline
            mymap.fitBounds(polyline.getBounds());

            var avghr = 0;
            var avghrcount = xmlDoc.getElementsByTagName("gpxtpx:hr").length;
            for (i =0; i < avghrcount; i++) {
                avghr = +avghr + +xmlDoc.getElementsByTagName("gpxtpx:hr")[i].childNodes[0].nodeValue;
            }
            avghr = +avghr/+avghrcount
            document.getElementById("average-HR").innerHTML = avghr;
            /*
            var avgcad = 0;
            var avgcadcount = xmlDoc.getElementsByTagName("ns3:cad").length;
            for (i =0; i < avgcadcount; i++) {
                avgcad = +avgcad + +xmlDoc.getElementsByTagName("ns3:cad")[i].childNodes[0].nodeValue;
            }
            avgcad = +avgcad/+avgcadcount
            document.getElementById("average-CAD").innerHTML = avgcad;
            */
            var elelist = xmlDoc.getElementsByTagName("ele");
            for (b = 0; b < elelist.length; b += 100) {
                var firstmarker = L.marker(plotcords[b]).addTo(mymap);
                firstmarker.bindPopup("<b>Elevation</b><br>" + elelist[b].childNodes[0].nodeValue);
            }
            //var firstmarker = L.marker(plotcords[0]).addTo(mymap);
            //firstmarker.bindPopup("<b>Elevation</b><br>" + elelist[0].childNodes[0].nodeValue);
            
        }

        function plotsinglepath() {

            //mymap.setView([51.505, -0.09], 13);

            // create a red polyline from an array of LatLng points
            var latlngs = [
            [45.51, -122.68],
            [37.77, -122.43],
            [34.04, -118.2]
            ];
            var polyline = L.polyline(latlngs, {color: 'red'}).addTo(mymap);
            // zoom the map to the polyline
            mymap.fitBounds(polyline.getBounds());
        }
    
    
    </script>

</body>


</html>